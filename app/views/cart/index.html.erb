<div class="container">
  <div class="row">
    <div class="col s12">
      <h4><%= t('cart.cart') %></h4>
      <div><%= link_to t('back'), models_path %></div><br>
        <div class="row">
          <div class="col s8 offset-s2">
            <div class="col s6">
              <%= link_to t('cart.edit_profile'), edit_user_path(current_user) %>
              <h5><%= current_user.full_name %></h5>
              <%= current_user.email %><br/>
              <%= current_user.phone %><br/>
            </div>
            <div class="col s6 right-align ">
              <% if !@company.nil? %>
                <%= link_to t('cart.edit_company'), edit_company_path(@company) %>
                <h5><%= @company.title %></h5>
                <%= @company.street  + ", " + @company.city %><br/>
                <%= @company.postal_code + ", " + Domain.find(@company.domain_id).meaning %><br>
                <%= @company.phone %>
              <% end %>
            </div>
          </div>
        </div>
      <div class="divider"></div>
      <!-- <div class="row section">
        <#% flash.each do |key, value| %>
          <div class="alert alert-<%#= key %> center flash-message"><%#= value %></div>
        <#% end %>
        <div class="col s8 offset-s2">
          <table class="striped centered">
            <thead>
              <tr>
                <th data-field="model-title"><%#= t('cart.product') %></th>
                <th data-field="product-color"><%#= t('cart.color') %></th>
                <th data-field="product-size"><%#= t('cart.size') %></th>
                <th data-field="quantity"><%#= t('cart.quantity') %></th>
                <th data-field="quantity"><%#= t('cart.cost') %></th>
                <th colspan="3"></th>
              </tr>
            </thead>
            <tbody>
              <#% if @cart.any? %>
                <#% @cart.each do |id, quantity| %>
                  <tr><%#= render "cart_row", id: id, quantity: quantity %></tr>
                <#% end %>
              <#% end %>          
            </tbody>
          </table>
        </div>
      </div> -->
      <div class="row section">
        <div class="col s8 offset-s2">
          <% if !@color_product_hash.empty? %>
            <% @color_product_hash.each do |model_id, colors| %>
              <h5><%= Model.find(model_id).title %></h5>
              <table id="product_table">
                <thead>
                  <tr>
                    <th></th>
                      <% @sizes.each do |size| %>
                        <th data-field='<%= size.code_value%>' colspan="3" class="center-align"><%= size.code_value%></th>
                      <% end %>
                  </tr>
                </thead>
                <tbody>
                  <% colors.each do |color_id, products|%>
                    <% color_meaning = Domain.find(color_id).meaning %>
                    <tr>
                      <td style="background: #<%=color_meaning%>"><%=color_meaning%></td>

<!-- jeigu yra produktas kuris atitinka spalva ir dydi
spausdini kiek, kitaip 0 -->
                    <% @sizes.each do |s|%>

                      <% if products.any?{|pr| pr["color_id"] == color_id && products[0]["product"].size_id == s.id } %>

                            <td><%= pr["quantity"]%></td>
                      <% else %>
                        <td><%= "0" %></td>
                      <% end %>

                    <% end %>

                    


                      <% @sizes.each do |s|%>
                        <% products.each do |pr| %>
                          <% binding.pry %> 
                          <% if s.id == pr["product"].size_id %>
                            <td><%= pr["quantity"]%></td>
                          <% else %>
                            <td><%= "0" %></td>
                          <% end %>
                        <%end%>
                        
                      <% end %>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            <% end %>
          <% end %>
        </div>
      </div>
      <div class="row">
        <div class="col s8 offset-s2">
          <div class="row">
            <% if !@cart_total_cost.nil? %>
              <h6 class="right"><b><%= t('cart.total_cost') %></b><%= sprintf "%.2f", @cart_total_cost %></h6>
            <% end %>
          </div>
          <div class="row">
            <div class="align-right">
              <%= link_to t('cart.confirm_order'), purchases_path, method: :post, :class => "btn waves-effect waves-light right" %>  
            </div>
            <div>
              <%= link_to t('cart.empty_cart'), cart_clear_path, :class => "btn waves-effect waves-light left" %>          
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


